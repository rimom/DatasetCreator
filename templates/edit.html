{% extends "base.html" %}

{% block content %}
<h1>Edit Conversation {{ conv_id + 1 }}</h1>

<form method="POST" action="{{ url_for('edit', conv_id=conv_id) }}">
    <!-- System Message -->
    <div class="mb-3">
        <label for="system_message" class="form-label">System Message:</label>
        <textarea class="form-control" id="system_message" name="system_message" rows="3">{{ system_message }}</textarea>
    </div>

    <!-- Persist Checkbox -->
    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="persist" name="persist" {% if persist %}checked{% endif %}>
        <label class="form-check-label" for="persist">
            Persist this message
        </label>
    </div>

    <hr>

    <!-- Message Pairs -->
    <h4>Message Pairs</h4>
    <div id="message-pairs">
        {% for pair in message_pairs %}
        <div class="message-pair mb-4">
            <div class="mb-2">
                <label class="form-label">User Message:</label>
                <textarea class="form-control user-message" name="user_message" rows="3" required {% if loop.first %}autofocus{% endif %}>{{ pair.user_message }}</textarea>
            </div>
            <div class="mb-2">
                <label class="form-label">Assistant Message:</label>
                <textarea class="form-control assistant-message" name="assistant_message" rows="3" required>{{ pair.assistant_message }}</textarea>
            </div>
            <div class="mb-2">
                <label class="form-label">Weight:</label>
                <input type="number" class="form-control" name="weight" value="{{ pair.weight }}" min="0" max="1" required>
            </div>
            <button type="button" class="btn btn-danger remove-pair">Remove</button>
        </div>
        {% endfor %}
    </div>

    <!-- Add Message Pair Button -->
    <button type="button" class="btn btn-secondary mb-3" id="add-pair">+ Add Message Pair</button>

    <!-- Action Buttons -->
    <div class="mb-3">
        <button type="submit" class="btn btn-primary">Update Conversation</button>
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
{% endblock %}
